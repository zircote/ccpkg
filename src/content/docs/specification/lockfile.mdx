---
title: "Lockfile"
description: "Lockfile format, schema, and usage for deterministic environment reproduction."
---

# Lockfile Format

The lockfile records the state of all installed packages at a given scope. It enables deterministic environment reproduction and team sharing.

## Location

| Scope | Lockfile Path |
|---|---|
| User | `~/.claude/ccpkg-lock.json` |
| Project | `{project-root}/.claude/ccpkg-lock.json` |

## Schema

```json
{
  "lockfile_version": 1,
  "packages": {
    "api-testing": {
      "version": "1.0.0",
      "spec_version": "2026-02-14",
      "checksum": "sha256:a1b2c3d4...",
      "installed_at": "2026-02-14T12:00:00Z",
      "scope": "project",
      "source": "https://example.com/api-testing-1.0.0.ccpkg",
      "config_hash": "sha256:f7e8d9c0...",
      "components": {
        "skills": ["skills/openapi-validator", "skills/request-generator"],
        "commands": ["commands/run-tests.md"],
        "hooks": "hooks/hooks.json",
        "mcp": "mcp/.mcp.json"
      }
    }
  },
  "shared_mcp_servers": {
    "context7": {
      "origin": "command::npx -y @anthropic/context7-mcp",
      "version": "1.3.0",
      "declared_by": ["plugin-a", "plugin-b"],
      "active_source": "plugin-b",
      "dedup": true,
      "installed_at": "2026-02-15T12:00:00Z"
    }
  }
}
```

**Lockfile fields:**

| Field | Type | Description |
|---|---|---|
| `lockfile_version` | `number` | The lockfile schema version. Currently `1`. |
| `packages` | `object` | Map of package name to install record. |

**Install record fields:**

| Field | Type | Description |
|---|---|---|
| `version` | `string` | Installed package version. |
| `spec_version` | `string` | The ccpkg spec version the package was built for. |
| `checksum` | `string` | SHA-256 hash of the installed archive. |
| `installed_at` | `string` | ISO 8601 timestamp of installation. |
| `scope` | `string` | Install scope (`"user"` or `"project"`). |
| `source` | `string` | The URL or path from which the package was installed. Prefixed with `link:` for dev-mode linked packages (e.g., `link:/Users/me/my-plugin`). |
| `config_hash` | `string` | SHA-256 hash of the resolved config values (excluding secrets). Used to detect config drift. |
| `components` | `object` | Mirror of the manifest `components` object for quick reference. |

**Shared MCP server fields:**

The `shared_mcp_servers` top-level field tracks MCP servers that are declared by multiple packages. Keys are MCP server key names.

| Field | Type | Description |
|---|---|---|
| `origin` | `string` | Identity origin string derived from server mode (see Server Deduplication in [Component Types](/specification/component-types/)). |
| `version` | `string \| null` | Resolved winning version. `null` if the server version cannot be determined. |
| `declared_by` | `string[]` | Package names that bundle this server. |
| `active_source` | `string` | Name of the package whose MCP template is currently rendered in the host config. |
| `dedup` | `boolean` | Whether deduplication is active for this server. Defaults to `true`. When `false`, each package installs its own independent copy. |
| `installed_at` | `string` | ISO 8601 timestamp of the last resolution event. |

## Usage

- **Project lockfiles** (`{project-root}/.claude/ccpkg-lock.json`) SHOULD be committed to version control. This allows team members to reproduce the same package environment.
- **User lockfiles** (`~/.claude/ccpkg-lock.json`) are personal and SHOULD NOT be shared.
- An installer MAY provide a `ccpkg restore` command that reads the lockfile and installs all listed packages at their recorded versions.

## Archive Cache

Installers MUST maintain a local cache of installed `.ccpkg` archives to support MCP server reassignment on uninstall (see [Install Lifecycle](/specification/install-lifecycle/)).

### Location

| Scope | Cache Path |
|---|---|
| User | `~/.claude/ccpkg-cache/archives/{name}-{version}.ccpkg` |
| Project | `{project-root}/.claude/ccpkg-cache/archives/{name}-{version}.ccpkg` |

### Retention

- Archives for packages referenced by any `declared_by` list in `shared_mcp_servers` MUST be retained.
- Archives for packages not referenced by any `declared_by` list MAY be evicted.
- Installers MAY provide a cache cleanup command to reclaim disk space.
